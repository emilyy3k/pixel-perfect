import{PixelPerfectFilter}from"./PixelArtFilter.js";Hooks.on("canvasReady",async()=>{console.log("pixel-perfect: Canvas is ready, initializing.");let r=new Map,o=e=>{if(e?.mesh){let t=r.get(e.id);var l=e.mesh,o=(t?.targetSprite&&t.targetSprite!==l&&t.targetSprite.filters&&(t.targetSprite.filters=t.targetSprite.filters.filter(e=>e!==t),0===t.targetSprite.filters.length)&&(t.targetSprite.filters=null),t||(console.log("pixel-perfect: Creating new filter for placeable "+e.id),t=new PixelPerfectFilter(e),r.set(e.id,t)),t.updatePlaceableData(e),l.filters||(l.filters=[]),l.filters?.some(e=>e===t)||!1);o?0<(o=l.filters.indexOf(t))&&(console.log("pixel-perfect: Moving filter to front for placeable "+e.id),l.filters.splice(o,1),l.filters.unshift(t)):(console.log("pixel-perfect: Adding filter to placeable sprite "+e.id),l.filters.unshift(t),console.log("pixel-perfect: Filter added, total filters: "+l.filters.length),e.texture?.baseTexture&&(e.texture.baseTexture.setStyle(PIXI.SCALE_MODES.LINEAR,PIXI.MIPMAP_MODES.ON),e.texture.baseTexture.valid||e.texture.baseTexture.update())),e.texture?.update()}else console.log("pixel-perfect: Placeable has no sprite or texture",e?.id)},i=e=>{let t=r.get(e.id);var l;t&&(console.log("pixel-perfect: Deleting filter instance for placeable "+e.id),(l=e.mesh)&&l.filters&&(l.filters=l.filters.filter(e=>e!==t),0===l.filters.length)&&(l.filters=null),"function"==typeof t.destroy&&t.destroy(),r.delete(e.id))};if(Hooks.on("refreshToken",o),Hooks.on("drawToken",o),Hooks.on("deleteToken",i),Hooks.on("refreshTile",o),Hooks.on("drawTile",o),Hooks.on("deleteTile",i),canvas.tokens)for(var e of canvas.tokens.placeables)o(e);if(canvas.tiles)for(var t of canvas.tiles.placeables)o(t);Hooks.on("deleteToken",i),Hooks.on("deleteTile",i),Hooks.on("canvasTearDown",()=>{console.log("pixel-perfect: Canvas tear down, cleaning up filters."),Hooks.off("refreshToken",o),Hooks.off("drawToken",o),Hooks.off("deleteToken",i),Hooks.off("refreshTile",o),Hooks.off("drawTile",o),Hooks.off("deleteTile",i);for(var[e,t]of r){var l=(canvas.tokens?.get(e)||canvas.tiles?.get(e))?.mesh;l&&(console.log("pixel-perfect: Cleaning up filters for placeable "+e),l.filters=l.filters?.filter(e=>!(e instanceof PixelPerfectFilter))||null,0===l.filters?.length)&&(l.filters=null)}r.clear()})});
//# sourceMappingURL=module.js.map
